<!DOCTYPE html>
<html>
	<head>
		<title>Timer</title>

		<!-- Sets initial viewport load -->
 		<meta name="viewport" content="initial-scale=1">

		<script src="https://fb.me/react-0.13.2.js"></script>
		<script src="https://fb.me/JSXTransformer-0.13.2.js"></script>
		<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<style type="text/css">
		button {
			font-size: 50px;
			width: 300px;
		}
		.timer {
			text-align: center;
		}
		.individual-time {
			font-size: 300px;
		}
		.group-time {
			font-size: 150px;
		}
		</style>
	</head>
	<body>
		<div id="example"></div>
		<script type="text/jsx">
			var TimeList = React.createClass({
				render: function() {
					var createItem = function(itemText, index) {
						return <li key={index + itemText}>{formatTime(itemText)}</li>;
					};
					return <ol>{this.props.items.map(createItem)}</ol>;
				}
			});
			var Timer = React.createClass({
				getInitialState: function() {
					return {
						secondsElapsed: 0,
						totalSecondsElapsed: 0,
						pauseButtonText: "Pause",
						items: []
					};
				},
				tick: function() {
					this.setState({
						secondsElapsed: this.state.secondsElapsed + 1,
						totalSecondsElapsed: this.state.totalSecondsElapsed + 1
					});
				},
				componentDidMount: function() {
					this.interval = setInterval(this.tick, 1000);
				},
				componentWillUnmount: function() {
					clearInterval(this.interval);
				},
				pause: function() {
					if (this.interval) {
						clearInterval(this.interval);
						this.interval = false;
						this.setState({pauseButtonText: "Continue"});
					} else {
						this.interval = setInterval(this.tick, 1000);
						this.setState({pauseButtonText: "Pause"});
					}
				},
				next: function() {
					var nextItems = this.state.items.concat([this.state.secondsElapsed]);
					this.setState({secondsElapsed: 0, items: nextItems});
				},
				render: function() {
					return (
						<div>
							<div className="timer">
								<div>Individual time</div>
								<div className="individual-time">{formatTime(this.state.secondsElapsed)}</div>
								<div>Group time</div>
								<div className="group-time">{formatTime(this.state.totalSecondsElapsed)}</div>
								<div>
									<button onClick={this.pause}>{this.state.pauseButtonText}</button>
									<button onClick={this.next}>Next</button>
								</div>
							</div>
							<TimeList items={this.state.items} />
						</div>
					);
				}
			});

			React.render(<Timer />, document.getElementById('example'));

			//
			// http://stackoverflow.com/questions/5539028/converting-seconds-into-hhmmss/5539081#5539081
			//
			function formatTime(d) {
				d = Number(d);
				var h = Math.floor(d / 3600);
				var m = Math.floor(d % 3600 / 60);
				var s = Math.floor(d % 3600 % 60);
				return ((h > 0 ? h + ":" + (m < 10 ? "0" : "") : "") + m + ":" + (s < 10 ? "0" : "") + s);
			}
		</script>
	</body>
</html>
