<!DOCTYPE html>
<html>
	<head>
		<title>Timer</title>
		<script src="https://fb.me/react-0.13.2.js"></script>
		<script src="https://fb.me/JSXTransformer-0.13.2.js"></script>
		<script type="text/javascript" src="names.js"></script>
		<style type="text/css">
		.time-list {
			border: 1px solid #ccc;
			border-collapse: collapse;
			font-size: 20px;
		}
		.time-list th {
			padding: 0.5em 1em;
		}
		.time-list td {
			padding: 0.2em 1em;
		}
		.odd {
			background-color: #eee;
		}
		.even {
			background-color: #fff;
		}
		.active {
			background-color: yellow;
			font-weight: bold;
		}
		.time {
			text-align: right;
		}
		</style>
	</head>
	<body>
		<div id="example"></div>
		<script type="text/jsx">
			var TimeList = React.createClass({
				getInitialState: function() {
					var people = this.props.names.map(function(name, i) {
						return {name: name, seconds: 0};
					});

					return {
						activeIndex: -1,
						people: people
					};
				},
				getTotalSeconds: function() {
					var totalSeconds = 0;

					this.state.people.forEach(function(person, i) {
						totalSeconds += person.seconds;
					});

					return totalSeconds;
				},
				componentDidMount: function() {
					this.interval = setInterval(this.tick, 1000);
				},
				componentWillUnmount: function() {
					clearInterval(this.interval);
				},
				tick: function() {
					if (this.state.activeIndex > -1)
					{
						var nextItems = this.state.people;
						nextItems[this.state.activeIndex].seconds++;
						this.setState({people: nextItems});
					}
				},
				handleClick: function(i) {
					this.setState({activeIndex: i});
				},
				render: function() {
					return (
						<div>
							<table className="time-list">
								<thead>
									<tr>
										<th>{formatTime(this.getTotalSeconds())}</th>
										<th>Total</th>
									</tr>
								</thead>
								<tbody>
									{this.state.people.map(function(person, i) {
										var className = (i + 1) % 2 == 1 ? "odd" : "even";
										
										if (i == this.state.activeIndex) {
											className += " active";
										}

										return (
											<tr onClick={this.handleClick.bind(this, i)} onTouchStart={this.handleClick.bind(this, i)} className={className}>
												<td className="time">{formatTime(person.seconds)}</td>
												<td>{person.name}</td>
											</tr>
										);
									}, this)}
								</tbody>
							</table>
						</div>
					);
				}
			});
			
			var mountNode = document.getElementById('example');
			React.render(<TimeList names={names} />, mountNode);


			function formatTime(d) {
				d = Number(d);

				var secondsInMinute = 60;
				var minutesInHour = 60;
				var secondsInHour = minutesInHour * secondsInMinute;

				var h = Math.floor(d / secondsInHour);
				var m = Math.floor(d % secondsInHour / secondsInMinute);
				var s = d % secondsInHour % secondsInMinute;

				return ((h > 0 ? h + ":" + (m < 10 ? "0" : "") : "") + m + ":" + (s < 10 ? "0" : "") + s);
			}
		</script>
	</body>
</html>
